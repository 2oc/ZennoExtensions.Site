<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Методы расширения &middot; ZennoExtensions
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="page">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        ZennoExtensions
      </a>
    </div>
    <p class="lead">Библиотека для <a href="http://zennolab.com/ru/products/zennoposter/" target="_blank">ZennoPoster</a></p>
  </header>
  
  <a class="page-link" href="http://zennolab.com/discussion/" target="_blank">Форум ZennoLab</a>

  <br/>

  <div class="lead">Статьи</div>
  <ul>
    <li>
      <a class="page-link "
         
         href="/start">Подключение</a>
    </li>
    <li>
      <a class="page-link "
        
        href="/AccountManager">Менеджер аккаунтов</a>
    </li>
    <li>
      <a class="page-link "
        
        href="/BrowserManager">Настройка браузера</a>
    </li>
    <li>
      <a class="page-link "
         
         href="/MultiLogger">Логирование</a>
    </li>
    <li>
      <a class="page-link  active"
         style="color: #00ccff"
         href="/ExtensionMethods">Методы расширения</a>
    </li>
  </ul>
  <a class="page-link "
     
     href="/docs">Документация</a>
  <ul>
    <li>
      <a class="page-link "
         
         href="/docs/#AccountManager">Менеджер аккаунтов</a>
    </li>
    <li>
      <a class="page-link "
         
         href="/docs/#Browser">Настройка браузера</a>
    </li>
    <li>
      <a class="page-link "
         
         href="/docs/#MultiLogger">Мультилогер</a>
    </li>
    <li>
      <a class="page-link "
         
         href="/docs/#Instance">Instance</a>
    </li>
    <li>
      <a class="page-link "
         
         href="/docs/#Project">Project</a>
    </li>
    <li>
      <a class="page-link "
         
      href="/docs/#Variables">Project.Variables</a>
    </li>
    <li>
      <a class="page-link "
         
         href="/docs/#Tab">Tab</a>
    </li>
    <li>
      <a class="page-link "
         
         href="/docs/#HtmlElement">HtmlElement</a>
    </li>
    <li>
      <a class="page-link "
         
         href="/docs/#DateTime">DateTime</a>
    </li>
    <li>
      <a class="page-link "
         
         href="/docs/#Int32">Int32</a>
    </li>
  </ul>

</div>

    <main class="container">
      <header>
  <h1 class="page-title">Методы расширения</h1>
</header>
<div class="content">
  <hr />

<p>Для использования методов расширения подключите пространство имен:</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">ZennoExtensions.Extensions</span><span class="p">;</span>
</code></pre></div></div>

<hr />

<h2 id="работа-с-методами-расширения-локальных-переменных">Работа с методами расширения локальных переменных</h2>

<p>Методы расширения локальных переменных делятся на три категории:</p>

<ol>
  <li>
    <p>Методы <code class="highlighter-rouge">IsXXX</code> проверяют значение переменной на соответствие XXX и возвращают <code class="highlighter-rouge">true</code> или <code class="highlighter-rouge">false</code>.
Например, <code class="highlighter-rouge">IsInt()</code> проверяет является ли значение переменной целым числом:</p>

    <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kt">bool</span> <span class="n">isInt</span> <span class="p">=</span> <span class="n">project</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="s">"MyVariableName"</span><span class="p">].</span><span class="nf">IsInt</span><span class="p">();</span>	
 <span class="k">if</span><span class="p">(</span><span class="n">isInt</span><span class="p">)</span>
 <span class="p">{</span>
     <span class="n">project</span><span class="p">.</span><span class="nf">SendInfoToLog</span><span class="p">(</span><span class="s">"Переменная MyVariableName является целым числом."</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Методы <code class="highlighter-rouge">ToXXX</code> конвертируют строковое значение переменной в XXX, где XXX — тип в который производится конвертация.
Например, метод <code class="highlighter-rouge">ToDouble</code> конвертирует значение переменной в <code class="highlighter-rouge">double</code>:</p>

    <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kt">double</span> <span class="k">value</span> <span class="p">=</span>  <span class="n">project</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="s">"MyVariableName"</span><span class="p">].</span><span class="nf">ToDouble</span><span class="p">();</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Методы <code class="highlighter-rouge">ThrowIfXXX</code> выбрасывают исключения, если выполняется условие XXX. В метод можно передать сообщение, с которым выброситься исключение. Если сообщение не задано, то будет использоваться сообщение по умолчанию.</p>

    <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">project</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="s">"MyVariableName"</span><span class="p">].</span><span class="nf">ThrowIfEmpty</span><span class="p">(</span><span class="s">"Переменная не задана."</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
</ol>

<p><br />
 Методы <code class="highlighter-rouge">ThrowIfXXX</code> можно объединять в цепочки, чтобы проверять переменную на соответствие нескольким условиям. Этот подход удобен при проверке данных, которые указывает пользователь во входных настройках:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">string</span> <span class="n">accountsPath</span> <span class="p">=</span> <span class="n">project</span><span class="p">.</span><span class="n">Variables</span><span class="p">[</span><span class="s">"AccountsPath"</span><span class="p">]</span>
                                 <span class="p">.</span><span class="nf">ThrowIfEmpty</span><span class="p">(</span><span class="s">"Путь к файлу аккаунтов не задан."</span><span class="p">)</span>
                                 <span class="p">.</span><span class="nf">ThrowIfFileNotExists</span><span class="p">(</span><span class="s">"Файл аккаунтов не найден."</span><span class="p">)</span>
                                 <span class="p">.</span><span class="nf">ThrowIfTextFileIsEmpty</span><span class="p">(</span><span class="s">"Файл аккаунтов пуст."</span>  <span class="p">)</span>
                                 <span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</code></pre></div></div>

<p>Также есть возможность указать свой метод, который будет вызываться прежде, чем метод <code class="highlighter-rouge">ThrowIfXXX</code> выбросит исключение. Это можно использовать при логировании.</p>

<p>Для этого нужно задать статическое свойство <code class="highlighter-rouge">InvokeBeforeExceptionThrowing</code> класса <code class="highlighter-rouge">Settings</code>. Метод принимает параметр типа <code class="highlighter-rouge">ExceptionArgs</code>, которые содержит имя метода, который намерен выбросить исключение, сообщение исключения и переменную, которая не прошла проверку.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Settings</span><span class="p">.</span><span class="n">InvokeBeforeExceptionThrowing</span> <span class="p">=</span> <span class="n">args</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">logMessage</span> <span class="p">=</span> <span class="s">"При проверке переменной "</span> <span class="p">+</span> <span class="p">((</span><span class="n">ILocalVariable</span><span class="p">)</span><span class="n">args</span><span class="p">.</span><span class="n">Variable</span><span class="p">).</span><span class="n">Name</span> <span class="p">+</span> <span class="s">" в методе "</span> <span class="p">+</span>
                        <span class="n">args</span><span class="p">.</span><span class="n">MethodName</span> <span class="p">+</span> <span class="s">"было выброшено исключение с сообщением "</span> <span class="p">+</span> <span class="n">args</span><span class="p">.</span><span class="n">Message</span><span class="p">;</span>
    <span class="nf">WriteToLog</span><span class="p">(</span><span class="n">logMessage</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<hr />

<h2 id="работа-с-методами-расширения-tab">Работа с методами расширения Tab</h2>

<p>Методы расширения <code class="highlighter-rouge">Tab</code> содержат как уникальные методы, не имеющие аналогов в <code class="highlighter-rouge">ZennoPoster</code>, так и обертки над стандартными методами, которые позволяют объединять методы в цепочки вызовов.</p>

<p>Например, вот как можно последовательно посетить два сайта используя обертки стандартных методов:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">instance</span><span class="p">.</span><span class="n">ActiveTab</span><span class="p">.</span><span class="nf">Go</span><span class="p">(</span><span class="s">"ya.ru"</span><span class="p">).</span><span class="nf">WaitLoading</span><span class="p">()</span>
                  <span class="p">.</span><span class="nf">Go</span><span class="p">(</span><span class="s">"google.com"</span><span class="p">).</span><span class="nf">WaitLoading</span><span class="p">();</span>
</code></pre></div></div>

<p>Та же логика, но без использования методов расширений:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">tab</span> <span class="p">=</span> <span class="n">instance</span><span class="p">.</span><span class="n">ActiveTab</span><span class="p">;</span>
<span class="n">tab</span><span class="p">.</span><span class="nf">Navigate</span><span class="p">(</span><span class="s">"ya.ru"</span><span class="p">);</span>
	
<span class="k">if</span><span class="p">(</span><span class="n">tab</span><span class="p">.</span><span class="n">IsBusy</span><span class="p">)</span>
  <span class="n">tab</span><span class="p">.</span><span class="nf">WaitDownloading</span><span class="p">()</span>
	
<span class="n">tab</span><span class="p">.</span><span class="nf">Navigate</span><span class="p">(</span><span class="s">"google.com"</span><span class="p">);</span>
	
<span class="k">if</span><span class="p">(</span><span class="n">tab</span><span class="p">.</span><span class="n">IsBusy</span><span class="p">)</span>
  <span class="n">tab</span><span class="p">.</span><span class="nf">WaitDownloading</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="методы-tabwaitfor">Методы <code class="highlighter-rouge">tab</code>.WaitFor</h3>

<p>Методы <code class="highlighter-rouge">WaitFor</code> выполняют ожидание в течении указанного времени, пока не выполниться условие.</p>

<ul>
  <li><code class="highlighter-rouge">WaitFor(string xpath, int number, int timeout) </code> выполняет ожидание, пока на странице не будет найден Html- элемент по указанному XPath, либо до истечения таймаута.</li>
  <li><code class="highlighter-rouge">WaitFor(string tags, string attrName, string attrValue, string searchKind,int number, int timeout)</code> выполняет ожидание, пока на странице не будет найден Html-элемент по указанном атрибутам, либо до истечения таймаута.</li>
  <li><code class="highlighter-rouge">WaitFor(Func&lt;bool&gt; predicate, int timeout)</code> выполняет ожидание, пока предикат не вернет <code class="highlighter-rouge">true</code>, либо до истечения таймаута.</li>
</ul>

<p>Эти методы удобны в использовании при динамическом изменении страницы, когда нужно дождаться появления элемента.</p>

<hr />

<h2 id="работа-с-методами-расширения-htmlelement">Работа с методами расширения HtmlElement</h2>

<p>В большинстве своем методы расширения <code class="highlighter-rouge">HtmlElement</code> это обертки над стандартными методами, за исключением пары методов, для реализации текучего синтаксиса, как в примере ниже.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">instance</span><span class="p">.</span><span class="n">ActiveTab</span><span class="p">.</span><span class="nf">GetElementByXpath</span><span class="p">(</span><span class="s">"//input"</span><span class="p">)</span>
                  <span class="p">.</span><span class="nf">ThrowIfNull</span><span class="p">(</span><span class="s">"Элемент не найден"</span><span class="p">)</span>
                  <span class="p">.</span><span class="nf">ScrollTo</span><span class="p">()</span>
                  <span class="p">.</span><span class="nf">Rise</span><span class="p">(</span><span class="n">Event</span><span class="p">.</span><span class="n">Focus</span><span class="p">)</span> 
                  <span class="p">.</span><span class="nf">ClickOn</span><span class="p">()</span>                              
                  <span class="p">.</span><span class="nf">AttributeSet</span><span class="p">(</span><span class="s">"value"</span><span class="p">,</span> <span class="s">"Lorem ipsum"</span><span class="p">)</span>
                  <span class="p">.</span><span class="nf">AttributeGet</span><span class="p">(</span><span class="s">"value"</span><span class="p">);</span>
</code></pre></div></div>

<p>Как видите, здесь также, как и в локальных переменных, присутствует метод <code class="highlighter-rouge">ThrowIfXXX</code>.</p>

<p>Помимо метода <code class="highlighter-rouge">ThrowIfNull</code>, еще есть методы <code class="highlighter-rouge">ThrowIfHidden</code>, который выбрасывает исключение, если элемент скрыт и <code class="highlighter-rouge">ThrowIfNullOrHidden</code>, который последовательно вызывает методы <code class="highlighter-rouge">ThrowIfNull</code> и <code class="highlighter-rouge">ThrowIfHidden</code>.</p>


</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>
